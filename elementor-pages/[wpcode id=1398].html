<section class="bg-white py-20 px-4" id="contactForm">
  <div class="max-w-7xl mx-auto">
    <h2 class="text-3xl font-bold text-[#b88f7c] text-center mb-12">Agenda Disponible</h2>
    <div class="grid md:grid-cols-2 gap-10 items-center">
      
      <!-- Columna izquierda: Formulario -->
      <div>
        <h3 class="text-xl font-semibold text-[#5a4b47] mb-6 text-center">¡Escríbenos!</h3>
        <form class="space-y-5" id="contactFormReal">
          
          <!-- Nombre -->
          <div>
            <label class="block text-sm font-medium text-[#5a4b47]">Nombre <span class="text-red-500">*</span></label>
            <input name="nombre" type="text" placeholder="Ingresa tu nombre"
              class="w-full border border-[#e7dad2] rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#b88f7c]" required />
          </div>

          <!-- Email -->
          <div>
            <label class="block text-sm font-medium text-[#5a4b47]">Email <span class="text-red-500">*</span></label>
            <input name="email" type="email" placeholder="Ingresa tu email"
              class="w-full border border-[#e7dad2] rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#b88f7c]" required />
          </div>

          <!-- Celular -->
          <div>
            <label class="block text-sm font-medium text-[#5a4b47]">Celular <span class="text-red-500">*</span></label>
            <div class="flex gap-2">
              <select name="indicativo"
                class="w-24 border border-[#e7dad2] rounded-md px-2 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#b88f7c]">
                <option value="+57">CO (+57)</option>
                <option value="+52">MX (+52)</option>
                <option value="+1">US (+1)</option>
              </select>
              <input name="telefono" type="tel" placeholder="Ingresa tu celular"
                class="flex-1 border border-[#e7dad2] rounded-md px-4 py-2 focus:outline-none focus:ring-2 focus:ring-[#b88f7c]" required />
            </div>
          </div>

          <!-- Procedimiento -->
          <div>
            <label class="block text-sm font-medium text-[#5a4b47]">Motivo de consulta <span class="text-red-500">*</span></label>
            <select name="procedimiento"
              class="w-full border border-[#e7dad2] rounded-md px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#b88f7c]" required>
              <option value="" disabled selected>Selecciona un servicio</option>
              <option>Obesidad y Metabolismo</option>
              <option>Diabetes Mellitus</option>
              <option>Chequeo Médico Preventivo</option>
              <option>Enfermedades Gastrointestinales</option>
              <option>Enfermedades Tiroideas</option>
              <option>Enfermedades Infecciosas</option>
            </select>
          </div>

          <!-- Comentarios -->
          <div>
            <label class="block text-sm font-medium text-[#5a4b47]">Comentarios: <span class="text-red-500">*</span></label>
            <textarea name="comentarios" rows="3" placeholder="¿Qué dudas tienes?"
              class="w-full border border-[#e7dad2] rounded-md px-4 py-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#b88f7c]" required></textarea>
          </div>

          <!-- Botón -->
          <div class="text-center pt-2">
            <button type="submit"
              class="bg-[#b88f7c] hover:bg-[#a77c6b] text-white font-semibold px-8 py-3 rounded-full transition">
              Enviar Información
            </button>
          </div>
        </form>
      </div>

      <!-- Columna derecha: Mapa -->
      <div>
       <iframe
  src="https://www.google.com/maps/embed?pb=!1m27!1m12!1m3!1d588.3433114596514!2d-75.43600818471224!3d6.1543226621402285!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m12!3e6!4m4!1s0x8e469deb10c01cc1%3A0x55a99dfeb9f3a409!3m2!1d6.1542137!2d-75.435459!4m5!1s0x8e469deb10c01cc1%3A0x55a99dfeb9f3a409!2s5H37%2BQP%20V%C3%ADa%20aeropuerto%2C%20Cl.%2051%20%23Km%202.2%2C%20Rionegro%2C%20Antioquia!3m2!1d6.1542137!2d-75.435459!5e0!3m2!1ses!2sco!4v1750855446369!5m2!1ses!2sco"
  width="100%"
  height="500"
  style="border:0;"
  allowfullscreen=""
  loading="lazy"
  referrerpolicy="no-referrer-when-downgrade"
  class="rounded-xl shadow-md">
</iframe>




      </div>
    </div>
  </div>
</section>


<!-- Script -->
<script>
  async function handleSubmit(event) {
    event.preventDefault();

    const form = event.target;
    const sendButton = form.querySelector('button[type="submit"]');
    sendButton.disabled = true;

    const nombre = form.elements["nombre"].value.trim();
    const email = form.elements["email"].value.trim();
    const telefono = form.elements["telefono"].value.trim();
    const indicativo = form.elements["indicativo"].value;
    const procedimiento = form.elements["procedimiento"].value;
    const comentarios = form.elements["comentarios"].value.trim();

    if (!nombre || !email || !telefono || !comentarios || !procedimiento) {
      console.error("Faltan datos obligatorios");
      sendButton.disabled = false;
      return;
    }

    const getURLParameter = (name) => {
      name = name.replace(/[[]/, "\\[").replace(/[\]]/, "\\]");
      const regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
      const results = regex.exec(location.search);
      return results === null
        ? ""
        : decodeURIComponent(results[1].replace(/\+/g, " "));
    };

    const data = {
      nombre,
      email,
      celular: indicativo + telefono,
      modalidad: comentarios,
      procedimiento,
      utm_source: getURLParameter("utm_source"),
      utm_medium: getURLParameter("utm_medium"),
      utm_campaign: getURLParameter("utm_campaign"),
      utm_term: getURLParameter("utm_term"),
      utm_content: getURLParameter("utm_content"),
      gclid: getURLParameter("gclid"),
      dclid: getURLParameter("dclid"),
      fclid: getURLParameter("fclid"),
      pipeline: "martin",
    };

    if (typeof dataLayer !== "undefined") {
      dataLayer.push({ event: "Whatsapp_form_submitted" });
    }

    try {
      const response = await fetch("https://connect.pabbly.com/workflow/sendwebhookdata/IjU3NjYwNTZmMDYzMjA0MzU1MjZlNTUzNTUxMzEi_pc", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      if (!response.ok) throw new Error("Error en la respuesta del servidor");

      console.log("Datos enviados correctamente");
      form.reset();
      showSuccessPopup();
    } catch (error) {
      console.error("Error al enviar los datos:", error);
    } finally {
      sendButton.disabled = false;
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("contactFormReal").addEventListener("submit", handleSubmit);
  });

  function showSuccessPopup() {
    document.getElementById("successPopup").classList.remove("hidden");
    document.getElementById("successPopup").classList.add("flex");
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("closePopup").addEventListener("click", () => {
      document.getElementById("successPopup").classList.add("hidden");
      document.getElementById("successPopup").classList.remove("flex");
    });
  });
</script>

<!-- Popup de éxito -->
<div id="successPopup" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center">
  <div class="bg-white p-10 rounded-xl max-w-md w-full text-center shadow-2xl relative">
    <button id="closePopup" class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-xl">&times;</button>
    <h3 class="text-xl font-bold text-gray-800 mb-3">¡Gracias por contactarnos!</h3>
    <p class="text-gray-600 text-sm leading-relaxed">
      Hemos recibido tu solicitud correctamente. Nuestro equipo se pondrá en contacto contigo muy pronto para brindarte una asesoría personalizada.
    </p>
  </div>
</div>

