<!-- Sección: Contáctanos -->
<section class="py-20 px-6 bg-white text-center" id="contactForm">
  <div class="max-w-3xl mx-auto">
    <!-- Encabezado -->
    <h2 class="text-3xl font-semibold text-gray-700 mb-2">Contáctanos</h2>
    <p class="text-lg text-[#6e6765] mb-6">¡Nosotros te escribimos!</p>
    <p class="text-sm text-gray-600 mb-10 leading-relaxed">
      Diligencia el siguiente formulario y te compartiremos una cotización aproximada. Recuerda que los precios pueden variar según tus necesidades, tecnologías a utilizar y otros factores. ¡Escríbenos!
    </p>

    <!-- Formulario -->
    <form class="space-y-6 text-left" id="contactFormReal">
      <!-- Nombre -->
      <div>
        <label class="block mb-1 font-medium text-sm text-gray-700">Nombre <span class="text-red-500">*</span></label>
        <input name="nombre" type="text" placeholder="Ingresa tu nombre"
          class="w-full border border-gray-200 rounded-md px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#d9c3b9]" required />
      </div>

      <!-- Email -->
      <div>
        <label class="block mb-1 font-medium text-sm text-gray-700">Email <span class="text-red-500">*</span></label>
        <input name="email" type="email" placeholder="Ingresa tu email"
          class="w-full border border-gray-200 rounded-md px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#d9c3b9]" required />
      </div>

      <!-- Celular -->
      <div>
        <label class="block mb-1 font-medium text-sm text-gray-700">Celular <span class="text-red-500">*</span></label>
        <div class="flex gap-2">
          <select name="indicativo"
            class="w-24 h-[48px] border border-gray-200 rounded-md px-2 text-sm focus:outline-none focus:ring-2 focus:ring-[#d9c3b9]">
            <option value="+57">CO (+57)</option>
            <option value="+52">MX (+52)</option>
            <option value="+1">US (+1)</option>
          </select>
          <input name="telefono" type="tel" placeholder="Ingresa tu celular"
            class="flex-1 border border-gray-200 rounded-md px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#d9c3b9]" required />
        </div>
      </div>

      <!-- Procedimiento de Interés -->
      <!-- Campo nuevo: Procedimiento de interés -->
<div>
  <label class="block mb-1 font-medium text-sm text-gray-700">Procedimiento de interés <span class="text-red-500">*</span></label>
  <select name="procedimiento" required
    class="w-full border border-gray-200 rounded-md px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#d9c3b9]">
    <option value="" disabled selected>Selecciona un procedimiento</option>
    <!-- Faciales -->
    <option>Lipopapada</option>
    <option>Blefaroplastia</option>
    <option>Mentoplastia</option>
    <option>Otoplastia</option>
    <option>Rinoplastia</option>
    <option>Ritidoplastia</option>

    <!-- Corporales -->
    <option>Mommy Makeover</option>
    <option>Abdominoplastia</option>
    <option>Cirugías reconstructivas</option>
    <option>Gluteoplastia</option>
    <option>Liposucción</option>
    <option>Mamoplastia de aumento</option>
    <option>Mamoplastia de reducción</option>
    <option>Mastopexia - Levantamiento de senos</option>
    <option>Explantación mamaria</option>

    <!-- No quirúrgicos -->
    <option>Toxina Botulínica</option>
    <option>Ácido Hialurónico</option>
    <option>Bioestimuladores</option>
	  <option>Otro...</option>
  </select>
</div>


      <!-- Comentarios -->
      <div>
        <label class="block mb-1 font-medium text-sm text-gray-700">Comentarios <span class="text-red-500">*</span></label>
        <textarea name="comentarios" rows="3" placeholder="¿En qué procedimiento estás interesado?"
          class="w-full border border-gray-200 rounded-md px-4 py-3 text-sm focus:outline-none focus:ring-2 focus:ring-[#d9c3b9]" required></textarea>
      </div>

      <!-- Botón -->
      <div class="text-center pt-6">
        <button type="submit"
          class="bg-[#d9c3b9] hover:bg-[#c8a89e] text-white font-semibold px-10 py-3 rounded-full transition">
          REGISTRARME
        </button>
      </div>
    </form>
  </div>
</section>

<!-- Script -->
<script>
  async function handleSubmit(event) {
    event.preventDefault();

    const form = event.target;
    const sendButton = form.querySelector('button[type="submit"]');
    sendButton.disabled = true;

    const nombre = form.elements["nombre"].value.trim();
    const email = form.elements["email"].value.trim();
    const telefono = form.elements["telefono"].value.trim();
    const indicativo = form.elements["indicativo"].value;
    const procedimiento = form.elements["procedimiento"].value;
    const comentarios = form.elements["comentarios"].value.trim();

    if (!nombre || !email || !telefono || !comentarios || !procedimiento) {
      console.error("Faltan datos obligatorios");
      sendButton.disabled = false;
      return;
    }

    const getURLParameter = (name) => {
      name = name.replace(/[[]/, "\\[").replace(/[\]]/, "\\]");
      const regex = new RegExp("[\\?&]" + name + "=([^&#]*)");
      const results = regex.exec(location.search);
      return results === null
        ? ""
        : decodeURIComponent(results[1].replace(/\+/g, " "));
    };

    const data = {
      nombre,
      email,
      celular: indicativo + telefono,
      modalidad: comentarios,
      procedimiento,
      utm_source: getURLParameter("utm_source"),
      utm_medium: getURLParameter("utm_medium"),
      utm_campaign: getURLParameter("utm_campaign"),
      utm_term: getURLParameter("utm_term"),
      utm_content: getURLParameter("utm_content"),
      gclid: getURLParameter("gclid"),
      dclid: getURLParameter("dclid"),
      fclid: getURLParameter("fclid"),
      pipeline: "daniela",
    };

    try {
      const response = await fetch("https://connect.pabbly.com/workflow/sendwebhookdata/IjU3NjYwNTZmMDYzMjA0MzU1MjZlNTUzNTUxMzEi_pc", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(data),
      });

      if (!response.ok) throw new Error("Error en la respuesta del servidor");

      console.log("Datos enviados correctamente");
      form.reset();
      showSuccessPopup();
    } catch (error) {
      console.error("Error al enviar los datos:", error);
    } finally {
      sendButton.disabled = false;
    }
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("contactFormReal").addEventListener("submit", handleSubmit);
  });

  function showSuccessPopup() {
    document.getElementById("successPopup").classList.remove("hidden");
    document.getElementById("successPopup").classList.add("flex");
  }

  document.addEventListener("DOMContentLoaded", () => {
    document.getElementById("closePopup").addEventListener("click", () => {
      document.getElementById("successPopup").classList.add("hidden");
      document.getElementById("successPopup").classList.remove("flex");
    });
  });
</script>

<!-- Popup de éxito -->
<div id="successPopup" class="fixed inset-0 bg-black bg-opacity-60 z-50 hidden items-center justify-center">
  <div class="bg-white p-10 rounded-xl max-w-md w-full text-center shadow-2xl relative">
    <button id="closePopup" class="absolute top-3 right-3 text-gray-400 hover:text-gray-700 text-xl">&times;</button>
    <h3 class="text-xl font-bold text-gray-800 mb-3">¡Gracias por contactarnos!</h3>
    <p class="text-gray-600 text-sm leading-relaxed">
      Hemos recibido tu solicitud correctamente. Nuestro equipo se pondrá en contacto contigo muy pronto para brindarte una asesoría personalizada.
    </p>
  </div>
</div>

