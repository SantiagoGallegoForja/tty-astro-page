---
/**
 * Premium Input Component
 * Reusable input with floating labels and icons
 */

interface Props {
  type?: 'text' | 'email' | 'tel' | 'number' | 'password' | 'url' | 'textarea' | 'select';
  name: string;
  label: string;
  placeholder?: string;
  value?: string;
  required?: boolean;
  disabled?: boolean;
  readonly?: boolean;
  icon?: 'user' | 'email' | 'phone' | 'message' | 'calendar' | 'location' | 'search' | 'none';
  error?: string;
  hint?: string;
  class?: string;
  id?: string;
  rows?: number;
  options?: Array<{ value: string; label: string }>;
  autocomplete?: string;
  pattern?: string;
  minlength?: number;
  maxlength?: number;
}

const {
  type = 'text',
  name,
  label,
  placeholder = ' ',
  value = '',
  required = false,
  disabled = false,
  readonly = false,
  icon = 'none',
  error,
  hint,
  class: className = '',
  id = name,
  rows = 4,
  options = [],
  autocomplete,
  pattern,
  minlength,
  maxlength,
} = Astro.props;

// Icon SVGs
const icons = {
  user: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>`,
  email: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/></svg>`,
  phone: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/></svg>`,
  message: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/></svg>`,
  calendar: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/></svg>`,
  location: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>`,
  search: `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/></svg>`,
  none: '',
};

const iconHtml = icon !== 'none' ? icons[icon] : '';
const hasIcon = icon !== 'none';

// Base input styles
const inputBaseStyles = `
  w-full bg-white rounded-xl
  border-2 transition-all duration-300 ease-out
  text-gray-800 placeholder-transparent
  focus:outline-none
  peer
`;

const inputNormalStyles = `
  border-primary-100
  focus:border-primary-300 focus:ring-4 focus:ring-primary-100
`;

const inputErrorStyles = `
  border-error-400
  focus:border-error-400 focus:ring-4 focus:ring-error-100
`;

const inputDisabledStyles = `
  bg-gray-50 cursor-not-allowed opacity-60
`;

const paddingWithIcon = hasIcon ? 'pl-12 pr-4' : 'px-4';

// Combine styles
const inputStyles = [
  inputBaseStyles,
  error ? inputErrorStyles : inputNormalStyles,
  disabled ? inputDisabledStyles : '',
  paddingWithIcon,
  'pt-6 pb-2',
].join(' ');

// Label styles
const labelBaseStyles = `
  absolute left-4 transition-all duration-200 ease-out pointer-events-none
  text-gray-400
`;

const labelPositionWithIcon = hasIcon ? 'left-12' : 'left-4';
---

<div class={`relative ${className}`}>
  {/* Icon */}
  {hasIcon && (
    <div class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 z-10 peer-focus:text-primary-500 transition-colors duration-200">
      <Fragment set:html={iconHtml} />
    </div>
  )}

  {/* Input Field */}
  {type === 'textarea' ? (
    <textarea
      id={id}
      name={name}
      placeholder={placeholder}
      required={required}
      disabled={disabled}
      readonly={readonly}
      rows={rows}
      minlength={minlength}
      maxlength={maxlength}
      class={`${inputStyles} resize-none`}
    >{value}</textarea>
  ) : type === 'select' ? (
    <select
      id={id}
      name={name}
      required={required}
      disabled={disabled}
      class={`${inputStyles} appearance-none cursor-pointer bg-[url('data:image/svg+xml;charset=UTF-8,%3csvg%20xmlns%3d%22http%3a%2f%2fwww.w3.org%2f2000%2fsvg%22%20fill%3d%22none%22%20viewBox%3d%220%200%2024%2024%22%20stroke%3d%22%236e6765%22%3e%3cpath%20stroke-linecap%3d%22round%22%20stroke-linejoin%3d%22round%22%20stroke-width%3d%222%22%20d%3d%22M19%209l-7%207-7-7%22%2f%3e%3c%2fsvg%3e')] bg-[length:1.25rem] bg-[right_1rem_center] bg-no-repeat pr-10`}
    >
      <option value="" disabled selected>{placeholder !== ' ' ? placeholder : `Selecciona ${label.toLowerCase()}`}</option>
      {options.map((option) => (
        <option value={option.value} selected={option.value === value}>{option.label}</option>
      ))}
    </select>
  ) : (
    <input
      type={type}
      id={id}
      name={name}
      placeholder={placeholder}
      value={value}
      required={required}
      disabled={disabled}
      readonly={readonly}
      autocomplete={autocomplete}
      pattern={pattern}
      minlength={minlength}
      maxlength={maxlength}
      class={inputStyles}
    />
  )}

  {/* Floating Label */}
  <label
    for={id}
    class={`
      ${labelBaseStyles}
      ${labelPositionWithIcon}
      top-4 text-base
      peer-placeholder-shown:top-4 peer-placeholder-shown:text-base
      peer-focus:top-2 peer-focus:text-xs peer-focus:text-primary-600
      peer-[:not(:placeholder-shown)]:top-2 peer-[:not(:placeholder-shown)]:text-xs
      ${error ? 'peer-focus:text-error-500' : ''}
    `}
  >
    {label}
    {required && <span class="text-error-400 ml-0.5">*</span>}
  </label>

  {/* Error Message */}
  {error && (
    <p class="mt-1.5 text-sm text-error-500 flex items-center gap-1">
      <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
      </svg>
      {error}
    </p>
  )}

  {/* Hint Text */}
  {hint && !error && (
    <p class="mt-1.5 text-sm text-gray-500">{hint}</p>
  )}
</div>

<style>
  /* Custom focus ring animation */
  input:focus,
  textarea:focus,
  select:focus {
    box-shadow: 0 0 0 4px rgba(217, 195, 185, 0.2);
  }

  /* Error state focus ring */
  input.border-error-400:focus,
  textarea.border-error-400:focus,
  select.border-error-400:focus {
    box-shadow: 0 0 0 4px rgba(248, 113, 113, 0.2);
  }

  /* Autofill styling */
  input:-webkit-autofill,
  input:-webkit-autofill:hover,
  input:-webkit-autofill:focus {
    -webkit-text-fill-color: #4a4342;
    -webkit-box-shadow: 0 0 0px 1000px white inset;
    transition: background-color 5000s ease-in-out 0s;
  }
</style>
